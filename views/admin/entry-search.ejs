<!DOCTYPE html>
<html lang="en">
<head>
  <%- include("../baselinks") -%>
</head>
<body>
  <%- include("../header") -%>
  <div class="container">
    <h2>Search for an item to add or remove</h2>
    <form action="/entry/search" method="post">
      <div class="form-group">
        <div class="row">
          <div class="input-group col-sm-6">
            <input type="text" class="form-control" name="name" placeholder="Search by item name" aria-label="Item Name" aria-describedby="button-name">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary btn-md form-control" type="action" value="Confirm">Search</button>
            </div>
          </div>
          <div class="input-group col-sm-6">
            <input type="number" class="form-control" name="barcode" placeholder="Search by barcode" aria-label="Item Code" aria-describedby="button-code">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary btn-md form-control" type="action" value="Confirm">Search</button>
            </div>
          </div>
        </div>
      </div>
    </form>
    <table class="table">
			<thead>
				<tr>
					<th scope="col">Item Name</th>
					<th scope="col">Barcode</th>
					<th scope="col">Count</th>
					<th scope="col">Description</th>
          <th scope="col"></th>
				</tr>
			</thead>
			<tbody>
				<% if (response && response.items) {%>
				<% response.items.forEach((item) => {%>
				<tr>
					<th scope="row"><%= item.name%></th>
					<td><%= item.barcode%></td>
					<td><%= item.count%></td>
          <td><%= item.description%></td>
          <td class="text-right pr-0">
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-success" data-toggle="modal" data-target="#addModal" data-id="<%= item.id %>" data-name="<%= item.name %>" data-barcode="<%= item.barcode %>" data-count="<%= item.count %>"><i class="fas fa-plus"></i></button>
              <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#removeModal" data-id="<%= item.id %>" data-name="<%= item.name %>" data-barcode="<%= item.barcode %>" data-count="<%= item.count %>"><i class="fas fa-minus"></i></button>
            </div>
          </td>
				</tr>
				<% }); %>
				<% } %>
			</tbody>
		</table>
		<% if (response && response.error) {%>
		<div class="alert alert-danger">
			<%= response.error%>
		</div>
		<% } %>
  </div>
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addModalLabel">Add item</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form name="addForm" id="addForm" action="/entry/add" method="POST">
            <div class="form-group">
              <input class="form-control" type="text" name="id" id="addModalId" readonly hidden>
            </div>
            <div class="form-group">
              <label for="addModalName">Item Name</label>
              <input class="form-control" type="text" name="name" id="addModalName" placeholder="Item Name" readonly>
            </div>
            <div class="form-group">
              <label for="addModalBarcode">Barcode</label>
              <input class="form-control" type="text" name="barcode" id="addModalBarcode" placeholder="Barcode" readonly>
            </div>
            <div class="form-group">
              <label for="addModalQuantity">Quantity to add</label>
              <input class="form-control" type="number" name="quantity" id="addModalQuantity" min="1">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submitAdd">Submit</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="removeModal" tabindex="-1" role="dialog" aria-labelledby="removeModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="removeModalLabel">Remove item</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form name="removeForm" id="removeForm" action="/entry/remove" method="POST">
            <div class="form-group">
              <input class="form-control" type="text" name="id" id="removeModalId" readonly hidden>
            </div>
            <div class="form-group">
              <label for="removeModalName">Item Name</label>
              <input class="form-control" type="text" name="name" id="removeModalName" placeholder="Item Name" readonly>
            </div>
            <div class="form-group">
              <label for="removeModalBarcode">Barcode</label>
              <input class="form-control" type="text" name="barcode" id="removeModalBarcode" placeholder="Barcode" readonly>
            </div>
            <div class="form-group">
              <label for="removeModalQuantity">Quantity to remove</label>
              <input class="form-control" type="number" name="quantity" id="removeModalQuantity" min="1">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submitRemove">Submit</button>
        </div>
      </div>
    </div>
  </div>
  <% if(response.scanResult) { %>
  <div class="modal fade" id="foundModal" tabindex="-1" role="dialog" aria-labelledby="foundModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="foundModalLabel">Item found on Datakick</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form name="foundForm" id="foundForm" action="/entry/found" method="POST">
            <div class="form-group">
              <label for="foundModalName">Item Name</label>
              <input class="form-control" type="text" name="name" id="foundModalName" placeholder="Item Name" readonly
              value="<%= response.scanResult.name %>">
            </div>
            <div class="form-group">
              <label for="foundModalBarcode">Barcode</label>
              <input class="form-control" type="text" name="barcode" id="foundModalBarcode" placeholder="Barcode" readonly
              value="<%= response.scanResult.barcode %>">
            </div>
            <div class="form-group">
              <label for="foundModalDesc">Description</label>
              <input class="form-control" type="text" name="description" id="foundModalDescription" placeholder="Description" readonly
              value="<%= response.scanResult.ingredients %>">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submitFound">Continue</button>
        </div>
      </div>
    </div>
  </div>
  <% } %>
  <%- include("../scripts") -%>
  <script src="/static/js/entry.js"></script>
  <% if(response.scanResult) { %>
  <script type="text/javascript">
    $(window).on('load',function(){
        $('#foundModal').modal('show');
        $('#foundModalName').val("<%= response.scanResult.name %>");
        $('#foundModalBarcode').val("<%= response.scanResult.gtin14 %>");
        $('#foundModalDesc').val("<%= response.scanResult.desc %>");
    });
  </script>
  <% } %>
</body>
</html>
